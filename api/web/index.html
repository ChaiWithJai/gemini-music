<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maha Mantra Learning Studio</title>
  <meta name="theme-color" content="#0d0b08" />
  <link rel="icon" href="/poc/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/poc/apple-touch-icon.svg" />
  <link rel="manifest" href="/poc/site.webmanifest" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&family=Playfair+Display:ital,wght@0,600;0,700;1,600;1,700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/poc/styles.css" />
</head>
<body>

  <!-- Floating Navigation -->
  <nav class="floating-nav" aria-label="Practice progress">
    <span class="nav-wordmark">Maha Mantra <em>Studio</em></span>
    <div class="nav-dots" aria-label="Stage progress">
      <span class="nav-dot" data-stage="listen" title="Listen"></span>
      <span class="nav-dot" data-stage="guided" title="Guided"></span>
      <span class="nav-dot" data-stage="call_response" title="Call-Response"></span>
      <span class="nav-dot" data-stage="recap" title="Recap"></span>
      <span class="nav-dot" data-stage="independent" title="Independent"></span>
    </div>
  </nav>

  <main class="layout">

    <!-- Hero -->
    <header class="hero panel">
      <div class="hero-orb" aria-hidden="true"></div>
      <p class="kicker">Devotional Practice Platform</p>
      <h1 class="word-reveal">Maha Mantra <em>Learning Studio</em></h1>
      <p class="subtitle reveal-fade">
        Practice flow: 30s listen, guided follow-along, call-response with student turns, recap, and independent singing.
      </p>
    </header>

    <!-- Session Setup -->
    <section class="panel controls reveal-up">
      <span class="section-num">01</span>
      <h2>Session Setup</h2>
      <div class="form-grid">
        <label>
          Display name
          <input id="displayName" type="text" value="Hackathon Singer" maxlength="120" />
        </label>
        <label>
          Lineage
          <select id="lineageSelect">
            <option value="vaishnavism">Vaishnavism</option>
            <option value="sadhguru">Sadhguru</option>
            <option value="shree_vallabhacharya">Shree Vallabhacharya</option>
          </select>
        </label>
        <button id="initSessionBtn" class="btn primary">Initialize Session <span class="btn-arrow" aria-hidden="true">&rarr;</span></button>
      </div>
      <p id="sessionMeta" class="meta">Session not initialized.</p>
      <p class="meta">
        Source track: <a href="https://youtu.be/lZXeUhUc8PM?si=3VsDT1WX6AmZJA2b" target="_blank" rel="noreferrer">Maha Mantra Kirtan on YouTube</a>
      </p>
      <p id="timingMeta" class="meta">Timing source: loading transcript markers...</p>
    </section>

    <!-- Practice Player -->
    <section class="panel video-panel reveal-up">
      <span class="section-num">02</span>
      <h2>Practice Player</h2>
      <div id="player" class="player"></div>
      <div class="media-recovery" id="mediaRecovery" aria-live="polite">
        <p id="mediaStatus" class="meta media-status">Media mode: YouTube</p>
        <div class="media-actions">
          <button id="useFallbackBtn" class="btn media-btn" type="button">Use fallback track</button>
          <button id="retryYoutubeBtn" class="btn media-btn" type="button">Retry YouTube</button>
        </div>
      </div>
      <div class="status-bar">
        <div class="status-chip">
          <span class="chip-label">Stage</span>
          <span class="chip-value" id="currentStageLabel">Idle</span>
        </div>
        <div class="status-chip">
          <span class="chip-label">Turn</span>
          <span class="chip-value" id="turnLabel">-</span>
        </div>
        <div class="status-chip">
          <span class="chip-label">Countdown</span>
          <span class="chip-value" id="countdownLabel">-</span>
        </div>
      </div>
      <div id="micStatus" class="mic-indicator">
        <span class="mic-dot" aria-hidden="true"></span>
        <span class="mic-text">Mic: idle</span>
      </div>
    </section>

    <!-- Practice Flow -->
    <section class="panel flow reveal-up">
      <span class="section-num">03</span>
      <h2>Practice Flow</h2>
      <section class="interaction-queue" aria-label="Interaction queue">
        <article class="queue-lane now">
          <p class="queue-label">Now</p>
          <h3 id="queueNowTitle">Initialize Session</h3>
          <p id="queueNowCopy" class="queue-copy">You are here. Start a session to unlock practice.</p>
        </article>
        <article class="queue-lane next">
          <p class="queue-label">Next</p>
          <h3 id="queueNextTitle">Listen (30s)</h3>
          <p id="queueNextCopy" class="queue-copy">Next in 30s after setup.</p>
        </article>
        <article class="queue-lane later">
          <p class="queue-label">Later</p>
          <p id="queueLaterCopy" class="queue-copy">Why locked: complete each stage in sequence.</p>
        </article>
        <button id="queuePrimaryBtn" class="btn primary queue-primary" type="button" disabled>Initialize Session</button>
      </section>
      <div class="journey-ornament" aria-hidden="true">
        <svg class="journey-svg" viewBox="0 0 1400 240" preserveAspectRatio="none">
          <defs>
            <linearGradient id="serpentGlow" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="rgba(232,168,56,0.06)" />
              <stop offset="18%" stop-color="rgba(232,168,56,0.45)" />
              <stop offset="50%" stop-color="rgba(245,193,96,0.7)" />
              <stop offset="82%" stop-color="rgba(232,168,56,0.45)" />
              <stop offset="100%" stop-color="rgba(232,168,56,0.08)" />
            </linearGradient>
          </defs>
          <g class="journey-sacred">
            <circle cx="700" cy="120" r="96"></circle>
            <circle cx="700" cy="120" r="132"></circle>
            <circle cx="700" cy="120" r="168"></circle>
          </g>
          <path
            class="journey-serpent"
            d="M120 154 C250 58, 330 58, 390 154 S560 250, 660 154 S840 58, 930 154 S1090 250, 1180 154"
          />
          <path
            class="journey-serpent trail"
            d="M120 170 C250 74, 330 74, 390 170 S560 266, 660 170 S840 74, 930 170 S1090 266, 1180 170"
          />

          <g class="journey-node" data-stage="listen" transform="translate(120 154)">
            <g class="journey-rays">
              <line x1="0" y1="-28" x2="0" y2="-44"></line>
              <line x1="0" y1="28" x2="0" y2="44"></line>
              <line x1="-28" y1="0" x2="-44" y2="0"></line>
              <line x1="28" y1="0" x2="44" y2="0"></line>
              <line x1="20" y1="-20" x2="32" y2="-32"></line>
              <line x1="-20" y1="20" x2="-32" y2="32"></line>
              <line x1="-20" y1="-20" x2="-32" y2="-32"></line>
              <line x1="20" y1="20" x2="32" y2="32"></line>
            </g>
            <circle class="journey-ring" r="24"></circle>
            <circle class="journey-core" r="8"></circle>
            <text x="0" y="5">01</text>
          </g>

          <g class="journey-node" data-stage="guided" transform="translate(390 154)">
            <g class="journey-rays">
              <line x1="0" y1="-28" x2="0" y2="-44"></line>
              <line x1="0" y1="28" x2="0" y2="44"></line>
              <line x1="-28" y1="0" x2="-44" y2="0"></line>
              <line x1="28" y1="0" x2="44" y2="0"></line>
              <line x1="20" y1="-20" x2="32" y2="-32"></line>
              <line x1="-20" y1="20" x2="-32" y2="32"></line>
              <line x1="-20" y1="-20" x2="-32" y2="-32"></line>
              <line x1="20" y1="20" x2="32" y2="32"></line>
            </g>
            <circle class="journey-ring" r="24"></circle>
            <circle class="journey-core" r="8"></circle>
            <text x="0" y="5">02</text>
          </g>

          <g class="journey-node" data-stage="call_response" transform="translate(660 154)">
            <g class="journey-rays">
              <line x1="0" y1="-28" x2="0" y2="-44"></line>
              <line x1="0" y1="28" x2="0" y2="44"></line>
              <line x1="-28" y1="0" x2="-44" y2="0"></line>
              <line x1="28" y1="0" x2="44" y2="0"></line>
              <line x1="20" y1="-20" x2="32" y2="-32"></line>
              <line x1="-20" y1="20" x2="-32" y2="32"></line>
              <line x1="-20" y1="-20" x2="-32" y2="-32"></line>
              <line x1="20" y1="20" x2="32" y2="32"></line>
            </g>
            <circle class="journey-ring" r="24"></circle>
            <circle class="journey-core" r="8"></circle>
            <text x="0" y="5">03</text>
          </g>

          <g class="journey-node" data-stage="recap" transform="translate(930 154)">
            <g class="journey-rays">
              <line x1="0" y1="-28" x2="0" y2="-44"></line>
              <line x1="0" y1="28" x2="0" y2="44"></line>
              <line x1="-28" y1="0" x2="-44" y2="0"></line>
              <line x1="28" y1="0" x2="44" y2="0"></line>
              <line x1="20" y1="-20" x2="32" y2="-32"></line>
              <line x1="-20" y1="20" x2="-32" y2="32"></line>
              <line x1="-20" y1="-20" x2="-32" y2="-32"></line>
              <line x1="20" y1="20" x2="32" y2="32"></line>
            </g>
            <circle class="journey-ring" r="24"></circle>
            <circle class="journey-core" r="8"></circle>
            <text x="0" y="5">04</text>
          </g>

          <g class="journey-node" data-stage="independent" transform="translate(1180 154)">
            <g class="journey-rays">
              <line x1="0" y1="-28" x2="0" y2="-44"></line>
              <line x1="0" y1="28" x2="0" y2="44"></line>
              <line x1="-28" y1="0" x2="-44" y2="0"></line>
              <line x1="28" y1="0" x2="44" y2="0"></line>
              <line x1="20" y1="-20" x2="32" y2="-32"></line>
              <line x1="-20" y1="20" x2="-32" y2="32"></line>
              <line x1="-20" y1="-20" x2="-32" y2="-32"></line>
              <line x1="20" y1="20" x2="32" y2="32"></line>
            </g>
            <circle class="journey-ring" r="24"></circle>
            <circle class="journey-core" r="8"></circle>
            <text x="0" y="5">05</text>
          </g>
        </svg>
      </div>
      <div class="stage-strip">
        <article class="stage" id="stage-listen">
          <span class="stage-num">01</span>
          <h3>Listen (30s)</h3>
          <p>Absorb pronunciation, cadence, and phrasing before singing.</p>
          <button id="listenBtn" class="btn stage-btn" data-start-label="Start Listen" data-replay-label="Replay Listen" disabled>Start Listen</button>
        </article>

        <article class="stage" id="stage-guided">
          <span class="stage-num">02</span>
          <h3>Guided Follow-Along</h3>
          <p>Sing with the track. We score discipline, resonance, and coherence.</p>
          <button id="guidedBtn" class="btn stage-btn" data-start-label="Start Guided" data-replay-label="Replay Guided" disabled>Start Guided</button>
        </article>

        <article class="stage" id="stage-call">
          <span class="stage-num">03</span>
          <h3>Call-Response</h3>
          <p>Guru turn plays audio. Student turn mutes audio and scores your response.</p>
          <button id="callResponseBtn" class="btn stage-btn" data-start-label="Start Call-Response" data-replay-label="Replay Call-Response" disabled>Start Call-Response</button>
        </article>

        <article class="stage" id="stage-recap">
          <span class="stage-num">04</span>
          <h3>Performance Recap</h3>
          <p>See stage-level scoring and feedback before solo chanting.</p>
          <button id="recapBtn" class="btn stage-btn" data-start-label="Show Recap" data-replay-label="Replay Recap" disabled>Show Recap</button>
        </article>

        <article class="stage" id="stage-independent">
          <span class="stage-num">05</span>
          <h3>Independent Performance</h3>
          <p>Sing on your own and get final scoring + Bhav check.</p>
          <button id="independentBtn" class="btn stage-btn" data-start-label="Start Independent" data-replay-label="Replay Independent" disabled>Start Independent</button>
        </article>
      </div>
    </section>

    <!-- Scoring Output -->
    <section class="panel results reveal-up">
      <span class="section-num">04</span>
      <h2>Scoring Output</h2>
      <div id="resultsContainer" class="results-grid"></div>
      <details class="json-details">
        <summary>Raw JSON Output</summary>
        <pre id="finalJson" class="json-view">No evaluation yet.</pre>
      </details>
    </section>

  </main>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="/poc/app.js"></script>
</body>
</html>
